self.addEventListener("sync",e=>{console.log("Service Worker: Background sync",e.tag),"sync-offline-sales"===e.tag&&e.waitUntil(async function(){try{(await self.clients.matchAll()).forEach(e=>{e.postMessage({type:"SYNC_OFFLINE_SALES",timestamp:Date.now()})}),console.log("Service Worker: Notified clients to sync")}catch(e){console.error("Service Worker: Background sync failed",e)}}())}),self.addEventListener("message",e=>{if(e.data&&"SKIP_WAITING"===e.data.type&&self.skipWaiting(),e.data&&"CLEAR_CACHE"===e.data.type&&caches.keys().then(e=>{e.forEach(e=>{caches.delete(e)})}),e.data&&"CACHE_URLS"===e.data.type){const t=e.data.urls;t&&t.length>0&&caches.open("runtime-cache").then(e=>{e.addAll(t).catch(e=>{console.warn("Failed to cache URLs:",e)})})}}),self.addEventListener("push",e=>{console.log("Service Worker: Push received");let t={title:"نظام نقاط البيع",body:"إشعار جديد"};if(e.data)try{t=e.data.json()}catch(o){t.body=e.data.text()}const o={body:t.body,icon:"/assets/logo/El Farouk Group2.png",badge:"/assets/logo/El Farouk Group2.png",dir:"rtl",lang:"ar",vibrate:[100,50,100],data:t.data||{}};e.waitUntil(self.registration.showNotification(t.title,o))}),self.addEventListener("notificationclick",e=>{console.log("Service Worker: Notification clicked"),e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then(e=>{for(const t of e)if(t.url.includes("/pos")&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow("/pos")}))}),console.log("Custom Service Worker Extensions loaded");